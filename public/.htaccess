# .htaccess for Himalaya Krishi Website
# Prevent phantom URLs and malicious crawling

# Enable URL rewriting
RewriteEngine On

# Block suspicious URL patterns that might generate phantom URLs
RewriteCond %{REQUEST_URI} ^.*(Classic|ckyfue|trraqe|m109118175|m109203189).*$ [NC]
RewriteRule ^(.*)$ - [F,L]

# Block malformed Nepali language URLs
RewriteCond %{REQUEST_URI} ^.*Ne/ne/homes.*$ [NC]
RewriteRule ^(.*)$ - [F,L]

# Block URLs with suspicious patterns
RewriteCond %{REQUEST_URI} ^.*(Config|gravge).*$ [NC]
RewriteRule ^(.*)$ - [F,L]

# Redirect old URLs to correct ones
RewriteRule ^agriculture-support/?$ /agriculture-support-policies [R=301,L]
RewriteRule ^centers/?$ /NewsAboutUs [R=301,L]

# Block access to sensitive files
RewriteCond %{REQUEST_URI} ^.*\.(env|config|log|sql|bak)$ [NC]
RewriteRule ^(.*)$ - [F,L]

# Prevent access to development files
RewriteCond %{REQUEST_URI} ^.*(node_modules|src|scripts|\.git).*$ [NC]
RewriteRule ^(.*)$ - [F,L]

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# Cache control for static assets
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|webp|svg|ico|woff|woff2|ttf|eot)$">
    Header set Cache-Control "public, max-age=31536000"
</FilesMatch>

# Prevent hotlinking
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?krishihimalaya\.com [NC]
RewriteCond %{REQUEST_URI} \.(jpe?g|png|gif|webp|svg)$ [NC]
RewriteRule ^(.*)$ - [F,L]